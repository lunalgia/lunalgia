---
import { cn } from '@/lib/utils'
import { Icon } from 'astro-icon/components'
import { cva, type VariantProps } from 'class-variance-authority'

const calloutConfig = {
  note: {
    style: 'bg-blue-50 border-blue-200 dark:bg-blue-950/20 dark:border-blue-800',
    textColor: 'text-blue-700 dark:text-blue-300',
    icon: 'lucide:info',
  },
  tip: {
    style: 'bg-green-50 border-green-200 dark:bg-green-950/20 dark:border-green-800',
    textColor: 'text-green-700 dark:text-green-300',
    icon: 'lucide:lightbulb',
  },
  warning: {
    style: 'bg-amber-50 border-amber-200 dark:bg-amber-950/20 dark:border-amber-800',
    textColor: 'text-amber-700 dark:text-amber-300',
    icon: 'lucide:alert-triangle',
  },
  danger: {
    style: 'bg-red-50 border-red-200 dark:bg-red-950/20 dark:border-red-800',
    textColor: 'text-red-700 dark:text-red-300',
    icon: 'lucide:shield-alert',
  },
  important: {
    style: 'bg-purple-50 border-purple-200 dark:bg-purple-950/20 dark:border-purple-800',
    textColor: 'text-purple-700 dark:text-purple-300',
    icon: 'lucide:message-square-warning',
  },
  definition: {
    style: 'bg-teal-50 border-teal-200 dark:bg-teal-950/20 dark:border-teal-800',
    textColor: 'text-teal-700 dark:text-teal-400',
    icon: 'lucide:book-open',
  },
  axiom: {
    style: 'bg-teal-50 border-teal-200 dark:bg-teal-950/20 dark:border-teal-700',
    textColor: 'text-teal-600 dark:text-teal-300',
    icon: 'lucide:anchor',
  },
  notation: {
    style: 'bg-teal-50 border-teal-100 dark:bg-teal-950/15 dark:border-teal-800',
    textColor: 'text-teal-500 dark:text-teal-200',
    icon: 'lucide:pen-tool',
  },
  theorem: {
    style: 'bg-indigo-50 border-indigo-200 dark:bg-indigo-950/20 dark:border-indigo-800',
    textColor: 'text-indigo-700 dark:text-indigo-400',
    icon: 'lucide:check-circle',
  },
  lemma: {
    style: 'bg-indigo-50 border-indigo-200 dark:bg-indigo-950/20 dark:border-indigo-700',
    textColor: 'text-indigo-600 dark:text-indigo-300',
    icon: 'lucide:puzzle',
  },
  corollary: {
    style: 'bg-indigo-50 border-indigo-100 dark:bg-indigo-950/15 dark:border-indigo-800',
    textColor: 'text-indigo-500 dark:text-indigo-200',
    icon: 'lucide:git-branch',
  },
  proposition: {
    style: 'bg-indigo-50 border-indigo-100 dark:bg-indigo-950/15 dark:border-indigo-800',
    textColor: 'text-indigo-500 dark:text-indigo-200',
    icon: 'lucide:file-text',
  },
  conjecture: {
    style: 'bg-fuchsia-50 border-fuchsia-200 dark:bg-fuchsia-950/20 dark:border-fuchsia-800',
    textColor: 'text-fuchsia-700 dark:text-fuchsia-300',
    icon: 'lucide:help-circle',
  },
  proof: {
    style: 'bg-amber-50 border-amber-200 dark:bg-amber-950/20 dark:border-amber-700',
    textColor: 'text-amber-700 dark:text-amber-300',
    icon: 'lucide:check-square',
  },
  remark: {
    style: 'bg-sky-50 border-sky-100 dark:bg-sky-950/15 dark:border-sky-800',
    textColor: 'text-sky-500 dark:text-sky-200',
    icon: 'lucide:message-circle',
  },
  intuition: {
    style: 'bg-sky-50 border-sky-100 dark:bg-sky-950/15 dark:border-sky-800',
    textColor: 'text-sky-500 dark:text-sky-200',
    icon: 'lucide:lightbulb',
  },
  recall: {
    style: 'bg-sky-50 border-sky-100 dark:bg-sky-950/15 dark:border-sky-800',
    textColor: 'text-sky-500 dark:text-sky-200',
    icon: 'lucide:rotate-ccw',
  },
  example: {
    style: 'bg-sky-50 border-sky-200 dark:bg-sky-950/20 dark:border-sky-700',
    textColor: 'text-sky-600 dark:text-sky-300',
    icon: 'lucide:code',
  },
  explanation: {
    style: 'bg-sky-50 border-sky-200 dark:bg-sky-950/20 dark:border-sky-700',
    textColor: 'text-sky-600 dark:text-sky-300',
    icon: 'lucide:help-circle',
  },
  exercise: {
    style: 'bg-pink-50 border-pink-200 dark:bg-pink-950/20 dark:border-pink-800',
    textColor: 'text-pink-700 dark:text-pink-300',
    icon: 'lucide:dumbbell',
  },
  problem: {
    style: 'bg-pink-50 border-pink-200 dark:bg-pink-950/20 dark:border-pink-800',
    textColor: 'text-pink-700 dark:text-pink-300',
    icon: 'lucide:alert-circle',
  },
  answer: {
    style: 'bg-pink-50 border-pink-100 dark:bg-pink-950/15 dark:border-pink-800',
    textColor: 'text-pink-500 dark:text-pink-200',
    icon: 'lucide:check',
  },
  solution: {
    style: 'bg-pink-50 border-pink-100 dark:bg-pink-950/15 dark:border-pink-800',
    textColor: 'text-pink-500 dark:text-pink-200',
    icon: 'lucide:check-circle-2',
  },
  summary: {
    style: 'bg-emerald-50 border-emerald-200 dark:bg-emerald-950/20 dark:border-emerald-700',
    textColor: 'text-emerald-700 dark:text-emerald-300',
    icon: 'lucide:list',
  },
} as const

const capitalize = (str: string) => str.charAt(0).toUpperCase() + str.slice(1)

const calloutVariants = cva('relative px-4 py-4 my-6 border rounded-lg shadow-sm text-base transition-all duration-200 hover:shadow-md', {
  variants: {
    variant: Object.fromEntries(
      Object.entries(calloutConfig).map(([key, config]) => [key, config.style]),
    ),
  },
  defaultVariants: {
    variant: 'note',
  },
})

interface Props extends VariantProps<typeof calloutVariants> {
  title?: string
  class?: string
  variant?: keyof typeof calloutConfig
  defaultOpen?: boolean
}

const { title, variant = 'note', defaultOpen = true, ...rest } = Astro.props
---

<details
  class={cn(
    calloutVariants({ variant }),
    rest.class,
    '[&[open]>summary_svg:last-child]:rotate-180 [&[open]>summary]:mb-3',
  )}
  {...rest}
  open={defaultOpen}
>
  <summary
    class="flex cursor-pointer items-center font-medium [&::-webkit-details-marker]:hidden rounded-md -mx-1 -my-1 px-1 py-1 hover:bg-black/5 dark:hover:bg-white/5 transition-colors duration-150"
  >
    <Icon
      name={calloutConfig[variant].icon}
      class={cn('mr-3 size-4 flex-shrink-0', calloutConfig[variant].textColor)}
    />
    <span class={cn('font-semibold mr-2', calloutConfig[variant].textColor)}>
      {capitalize(variant)}
      {title && <span class="font-normal opacity-80 ml-1">â€” {title}</span>}
    </span>
    <Icon
      name="lucide:chevron-down"
      class={cn(
        'ml-auto h-4 w-4 shrink-0 transition-transform duration-200',
        calloutConfig[variant].textColor,
      )}
    />
  </summary>
  <div class="not-prose text-[12pt] leading-relaxed">
    <slot />
  </div>
</details>